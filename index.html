<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Игра "Жизнь" / Convay's Game of Life</title>
    <link rel="stylesheet" href= "./css/mainstyle.css">
  </head>
  <body>

    <div id="root"></div>

    <!-- React. -->
    <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>
    <!-- только для демонстраций и простых сайтов -->
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js" crossorigin></script>

    <script type="text/babel">
      
      class Box extends React.Component{
      	selectBox = () => {
      		this.props.selectBox(this.props.row, this.props.col);
      	}

      	render(){
      		return(
      			<div 
      				className={this.props.boxClass}
      				id={this.props.boxId}
      				onClick={this.selectBox}
      			>
      			</div>
      		)
      	}
      }

      class Grid extends React.Component {
        render(){
        	const width = (this.props.cols * 16);
        	var rowsArr = [];
        	var boxClass = "";
        	for(let i = 0; i < this.props.rows; i++){
        		for(let j = 0; j < this.props.cols; j++){
        			let boxId = 1 + "_" + j;

        			boxClass = this.props.gridFull[i][j] ? "box on" : "box off";
        			rowsArr.push(
        				<Box
        					boxClass = {boxClass}
        					key={boxId}
        					boxId={boxId}
        					row={i}
        					col={j}
        					selectBox={this.props.selectBox}
        				/>
        			)
        		}
        	}

          return(
            <div className="grid" style={{width: width}}>
              {rowsArr}
            </div>
          )
        }
      }

      class Main extends React.Component {
        constructor(){
          super();
          this.speed = 100;
          this.rows = 40;
          this.cols = 50;

          this.state = {
            generation: 0,
            //2-мерн.массив значений false-состояние клеток на доске
            gridFull: Array(this.rows).fill().map(()=>Array(this.cols).fill(false))

          }
        }

        selectBox = (row, col) =>{
        	let gridCopy = copyArray(this.state.gridFull);
        	gridCopy[row][col] = !gridCopy[row][col];
        	this.setState({
        		gridFull: gridCopy
        	})
        }

        initBoard = () => {
        	//генерируем живые клетки на доске
        	let gridCopy = copyArray(this.state.gridFull);
        	for(let i = 0; i < this.rows; i++){
        		for(let j = 0; j < this.cols; j++){
        			if (Math.floor(Math.random() * 4) === 1) {
        				gridCopy[i][j] = true;
        			}	
        		}
        	}
        	this.setState({ gridFull: gridCopy })	
        }

        componentDidMount(){
        	this.initBoard();
        }

        render() {
          return (
            <div>
              <h2>Игра "Жизнь" / Convay's Game of Life</h2>
              <Grid
              	gridFull = {this.state.gridFull}
              	cols = {this.cols}
              	rows = {this.rows}
              	selectBox = {this.selectBox}
              />
              <h3>Поколения: {this.state.generation}</h3>
            </div>
          )
        }
      }

    function copyArray(arr){
    	return JSON.parse(JSON.stringify(arr));
    }  

      ReactDOM.render(<Main />, document.getElementById("root"));
    
    </script>

  </body>
</html>